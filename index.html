<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Tutorial Demo</title>
</head>
<body>
<div id="container" style="height: 1000px; width: 2000px"></div>
<script src="https://gw.alipayobjects.com/os/lib/antv/g6/4.5.0/dist/g6.min.js"></script>



<script>
    // Tekstlengte: https://g6.antv.vision/en/examples/item/label#labelLen1
    // Contextmenu om stickers aan te passen:
    // https://g6.antv.vision/en/examples/tool/contextMenu#contextMenu
    // Sticker renderen:
    // https://g6.antv.vision/en/examples/item/customNode#svgDom
    // Toolbar:
    // https://g6.antv.vision/en/examples/tool/toolbar#toolbar


    const lightBlue = '#5b8ff9';
    const lightOrange = '#5ad8a6';

    G6.registerNode('sticker', {
        draw: (cfg, group) => {
            group.addShape("text", {
                attrs: {
                    y: 39,
                    x: 58,
                    fill: "#000",
                    text: cfg.label,
                    fontSize: 12,
                    fontWeight: 500,
                },
                draggable: true,
            });

            var sticker = group.addShape('path', {
                attrs: {
                    path: "M52.709,43.022L15.174,43.022C13.029,43.022 11.291,41.788 11.291,40.266L11.291,23.734C11.291,22.212 13.029,20.978 15.174,20.978L52.709,20.978L43.649,32L52.709,43.022Z",
                    lineWidth: 0,
                    fill: cfg.color,
                },
                name: 'sticker',
                draggable: true,
            });

            return sticker;
        },
    });

    // Register a custom behavior: click two end nodes to add an edge
    G6.registerBehavior('click-add-edge', {
        // Set the events and the corresponding responsing function for this behavior
        getEvents() {
            return {
                'node:click': 'onClick', // The event is canvas:click, the responsing function is onClick
                mousemove: 'onMousemove', // The event is mousemove, the responsing function is onMousemove
                'edge:click': 'onEdgeClick', // The event is edge:click, the responsing function is onEdgeClick
            };
        },
        // The responsing function for node:click defined in getEvents
        onClick(ev) {
            const self = this;
            const node = ev.item;
            const graph = self.graph;
            // The position where the mouse clicks
            const point = { x: ev.x, y: ev.y };
            const model = node.getModel();
            if (self.addingEdge && self.edge) {
                graph.updateItem(self.edge, {
                    target: model.id,
                });

                self.edge = null;
                self.addingEdge = false;
            } else {
                // Add anew edge, the end node is the current node user clicks
                self.edge = graph.addItem('edge', {
                    source: model.id,
                    target: model.id,
                });
                self.addingEdge = true;
            }
        },
        // The responsing function for mousemove defined in getEvents
        onMousemove(ev) {
            const self = this;
            // The current position the mouse clicks
            const point = { x: ev.x, y: ev.y };
            if (self.addingEdge && self.edge) {
                // Update the end node to the current node the mouse clicks
                self.graph.updateItem(self.edge, {
                    target: point,
                });
            }
        },
        // The responsing function for edge:click defined in getEvents
        onEdgeClick(ev) {
            const self = this;
            const currentEdge = ev.item;
            if (self.addingEdge && self.edge === currentEdge) {
                self.graph.removeItem(self.edge);
                self.edge = null;
                self.addingEdge = false;
            }
        },
    });

    const data = {
        nodes: [
            {id: "1", label: "PV - informeren verdachte", color: "#E44234", comboId: 'A', img: "sticker.svg"},
            {id: "2", label: "Bronnenlijst NFI", color: "#80E5B1"},
            {id: "3", label: "Munitie - foto2", color: "#FFC67B", comboId: 'B'},
            {id: "4", label: "Munitie - foto3", color: "#FFC67B", comboId: 'B'},
            {id: "5", label: "PV - verhoor getuige - Personalia", color: "#2E4B8B", comboId: 'A'},
            {id: "6", label: "art 9, lid 4 PolW 2012", color: "#88271F"},
            {id: "7", label: "PV - identificatie", color: "#E44234", comboId: 'A'},
            {id: "8", label: "PVB - gang van zaken - schoten", color: "#FFC67B", comboId: 'A'},
            {id: "9", label: "art 94 Sv", color: "#88271F"},
            {id: "10", label: "Munitie - onderzoek inleiding", color: "#FFC67B", comboId: 'B'},
            {id: "11", label: "Munitie - onderzoek algemeen", color: "#FFC67B", comboId: 'B'},
            {id: "12", label: "Munitie - nfi vuurwapens", color: "#FFC67B", comboId: 'B'},
            {id: "13", label: "Munitie - foto4", color: "#FFC67B", comboId: 'B'},
            {id: "14", label: "Verdachte - PV personalia", color: "#FFE6A2"},
            {id: "15", label: "PV - Grond aanhouding", color: "#E44234"},
            {id: "16", label: "Woordenlijst NFI vuurwapens", color: "#E2A1E6"},
            {id: "17", label: "PV - bevindingen", color: "#E44234"},
            {id: "18", label: "art 7, lid 4, PolW 2012", color: "#88271F"},
            {id: "19", label: "Art 7, lid 3, PolW 2012", color: "#88271F"},
            {id: "20", label: "Munitie - politieonderzoek", color: "#FFC67B", comboId: 'B'},
            {id: "21", label: "PV - Verhoor getuige - Niet NL-talig", color: "#2E4B8B", comboId: 'A'},
            {id: "22", label: "Munitie - PO labeling beslag hulzen", color: "#FFC67B", comboId: 'B'},
            {id: "23", label: "PVB - gang van zaken - mes", color: "#9C9C9C", comboId: 'A'},
            {id: "24", label: "KVI - Fileermes", color: "#9C9C9C"},
            {id: "25", label: "PVB - politie onderzoek - kogelfragment", color: "#FFC67B", comboId: 'A'},
            {id: "26", label: "PVB - politie onderzoek - mes", color: "#FFC67B", comboId: 'A'},
            {id: "27", label: "PVB - politieonderzoek - patroonhouders", color: "#FFC67B", comboId: 'A'},
            {id: "28", label: "Munitie - vergelijkend onderzoek", color: "#FFC67B"},
            {id: "29", label: "Munitie - vooronderzoek", color: "#FFC67B", comboId: 'B'},
            {id: "30", label: "Munitie pv", color: "#FFC67B", comboId: 'B'},
            {id: "31", label: "Munitie - foto1", color: "#FFC67B", comboId: 'B'},
            {id: "32", label: "Munitie - nfi sporen", color: "#FFC67B", comboId: 'B'},
            {id: "33", label: "Verdachte PV Aanhouding", color: "#FFE6A2", comboId: 'B'},
            {id: "34", label: "art. 56 Sv", color: "#88271F"},
            {id: "35", label: "art. 9 lid 2 Opw", color: "#88271F"},
            {id: "36", label: "art 52, lid 2 WWM", color: "#88271F"},
            {id: "37", label: "Verdachte - PV verhoor", color: "#FFE6A2", comboId: 'B'},
            {id: "38", label: "Munitie - PO bloedsporen", color: "#FFC67B", comboId: 'B'},
            {id: "39", label: "Munitie - PO kogelhuls plaats delict", color: "#FFC67B", comboId: 'B'},
            {id: "40", label: "Munitie - PO detailopname kogel", color: "#FFC67B", comboId: 'B'},
            {id: "41", label: "Munitie - PO - kogelhuls", color: "#FFC67B", comboId: 'B'},
            {id: "42", label: "Munitie - KVI hulzen", color: "#FFC67B", comboId: 'B'},
        ],
        edges: [
            {
                source: '0',
                target: '1',
            },
            {
                source: '0',
                target: '2',
            },
            {
                source: '1',
                target: '4',
            },
            {
                source: '0',
                target: '3',
            },
            {
                source: '3',
                target: '4',
            },
            {
                source: '2',
                target: '5',
            },
            {
                source: '1',
                target: '6',
            },
            {
                source: '1',
                target: '7',
            },
            {
                source: '3',
                target: '8',
            },
            {
                source: '3',
                target: '9',
            },
            {
                source: '5',
                target: '10',
            },
            {
                source: '5',
                target: '11',
            },
        ],
        combos: [
            {
                id: 'A',
                label: 'PV',
                style: {
                    fill: '#C4E3B2',
                    stroke: '#C4E3B2',
                },
            },
            {
                id: 'B',
                label: 'Munitie',
                style: {
                    stroke: '#99C0ED',
                    fill: '#99C0ED',
                },
            },
            {
                id: 'C',
                label: 'combo C',
                style: {
                    stroke: '#eee',
                    fill: '#eee',
                },
            },
        ],
    };

    data.nodes.forEach((node) => {
        switch (node.ComboId) {
            case 'A':
                node.style = {
                    fill: '#C4E3B2',
                    stroke: '#aaa',
                };
                break;
            case 'B':
                node.style = {
                    fill: '#99C0ED',
                    stroke: '#aaa',
                };
                break;
            case 'C':
                node.style = {
                    fill: '#eee',
                    stroke: '#aaa',
                };
                break;

        }
    });

    let sortByCombo = false;
    const descriptionDiv = document.createElement('button');
    descriptionDiv.innerHTML = 'Enable sortByCombo';
    const container = document.getElementById('container');

    // Add a selector to DOM
    const selector = document.createElement('select');
    selector.id = 'selector';
    const selection1 = document.createElement('option');
    selection1.value = 'default';
    selection1.innerHTML = 'Default Mode';
    const selection3 = document.createElement('option');
    selection3.value = 'addEdge';
    selection3.innerHTML = 'Add Edge (By clicking two end nodes)';
    selector.appendChild(selection1);
    selector.appendChild(selection3);
    container.appendChild(selector);

    container.appendChild(descriptionDiv);

    descriptionDiv.addEventListener('click', (e) => {
        sortByCombo = !sortByCombo;
        descriptionDiv.innerHTML = sortByCombo ? 'Disable sortByCombo' : 'Enable sortByCombo';
        graph.updateLayout({
            sortByCombo,
        });
    });
    const width = container.scrollWidth;
    const height = (container.scrollHeight || 500) - 30;
    const graph = new G6.Graph({
        container: 'container',
        width,
        height: height - 50,
        fitView: true,
        fitViewPadding: 30,
        animate: true,
        groupByTypes: true,
        modes: {
            default: [
                'drag-combo',
                'drag-node',
                'drag-canvas',
                'zoom-canvas',
                //'click-select',
                {
                    type: 'collapse-expand-combo',
                    relayout: false,
                },
            ],
            addEdge: ['click-add-edge', 'click-select', 'drag-canvas',
                'zoom-canvas', 'drag-node']
        },
        layout: {
            type: 'dagre',
            sortByCombo: true,
            ranksep: 50,
            nodesep: 50,
        },
        defaultNode: {
            type: 'sticker',
        },
        defaultEdge: {
            type: 'line',

        },
        defaultCombo: {
            type: 'rect',
            style: {
                fillOpacity: 0.1,
            },
        },
    });

    graph.on('wheelzoom', (e) => {
      e.stopPropagation();
      // className g6-component-tooltip by default
      const tooltips = Array.from(document.getElementsByClassName('g6-component-tooltip'));
      tooltips.forEach((tooltip) => {
        if (tooltip && tooltip.style) {
          tooltip.style.transform = `scale(${graph.getZoom()})`;
        }
      });
    });

    /*
    graph.on('nodeselectchange', (e) => {
        // The current manipulated item
        console.log(e.target);
        // The set of selected items after this operation
        console.log(e.selectedItems);
        // A boolean tag to distinguish if the current operation is select(`true`) or deselect (`false`)
        console.log(e.select);
    });*/

    graph.data(data);
    graph.render();

    selector.addEventListener('change', (e) => {
        const value = e.target.value;
        // change the behavior mode
        graph.setMode(value);
    });

    // Last part
    if (typeof window !== 'undefined')
        window.onresize = () => {
            if (!graph || graph.get('destroyed')) return;
            if (!container || !container.scrollWidth || !container.scrollHeight) return;
            graph.changeSize(container.scrollWidth, container.scrollHeight - 30);
        };



</script>
</body>
</html>
