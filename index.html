<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Tutorial Demo</title>
</head>
<body>
<div id="container" style="height: 1000px; width: 2000px"></div>
<script src="https://gw.alipayobjects.com/os/lib/antv/g6/4.5.0/dist/g6.min.js"></script>

<script>
    // Tekstlengte: https://g6.antv.vision/en/examples/item/label#labelLen1
    // Contextmenu om stickers aan te passen:
    // https://g6.antv.vision/en/examples/tool/contextMenu#contextMenu
    // Sticker renderen:
    // https://g6.antv.vision/en/examples/item/customNode#svgDom
    // Toolbar:
    // https://g6.antv.vision/en/examples/tool/toolbar#toolbar
    const data = {
        nodes: [
            {id: "1", label: "PV - informeren verdachte", color: "#E44234", comboId: 'A'},
            {id: "2", label: "Bronnenlijst NFI", color: "#80E5B1"},
            {id: "3", label: "Munitie - foto2", color: "#FFC67B", comboId: 'B'},
            {id: "4", label: "Munitie - foto3", color: "#FFC67B", comboId: 'B'},
            {id: "5", label: "PV - verhoor getuige - Personalia", color: "#2E4B8B", comboId: 'A'},
            {id: "6", label: "art 9, lid 4 PolW 2012", color: "#88271F"},
            {id: "7", label: "PV - identificatie", color: "#E44234", comboId: 'A'},
            {id: "8", label: "PVB - gang van zaken - schoten", color: "#FFC67B", comboId: 'A'},
            {id: "9", label: "art 94 Sv", color: "#88271F"},
            {id: "10", label: "Munitie - onderzoek inleiding", color: "#FFC67B", comboId: 'B'},
            {id: "11", label: "Munitie - onderzoek algemeen", color: "#FFC67B", comboId: 'B'},
            {id: "12", label: "Munitie - nfi vuurwapens", color: "#FFC67B", comboId: 'B'},
            {id: "13", label: "Munitie - foto4", color: "#FFC67B", comboId: 'B'},
            {id: "14", label: "Verdachte - PV personalia", color: "#FFE6A2"},
            {id: "15", label: "PV - Grond aanhouding", color: "#E44234"},
            {id: "16", label: "Woordenlijst NFI vuurwapens", color: "#E2A1E6"},
            {id: "17", label: "PV - bevindingen", color: "#E44234"},
            {id: "18", label: "art 7, lid 4, PolW 2012", color: "#88271F"},
            {id: "19", label: "Art 7, lid 3, PolW 2012", color: "#88271F"},
            {id: "20", label: "Munitie - politieonderzoek", color: "#FFC67B", comboId: 'B'},
            {id: "21", label: "PV - Verhoor getuige - Niet NL-talig", color: "#2E4B8B", comboId: 'A'},
            {id: "22", label: "Munitie - PO labeling beslag hulzen", color: "#FFC67B", comboId: 'B'},
            {id: "23", label: "PVB - gang van zaken - mes", color: "#9C9C9C", comboId: 'A'},
            {id: "24", label: "KVI - Fileermes", color: "#9C9C9C"},
            {id: "25", label: "PVB - politie onderzoek - kogelfragment", color: "#FFC67B", comboId: 'A'},
            {id: "26", label: "PVB - politie onderzoek - mes", color: "#FFC67B", comboId: 'A'},
            {id: "27", label: "PVB - politieonderzoek - patroonhouders", color: "#FFC67B", comboId: 'A'},
            {id: "28", label: "Munitie - vergelijkend onderzoek", color: "#FFC67B"},
            {id: "29", label: "Munitie - vooronderzoek", color: "#FFC67B", comboId: 'B'},
            {id: "30", label: "Munitie pv", color: "#FFC67B", comboId: 'B'},
            {id: "31", label: "Munitie - foto1", color: "#FFC67B", comboId: 'B'},
            {id: "32", label: "Munitie - nfi sporen", color: "#FFC67B", comboId: 'B'},
            {id: "33", label: "Verdachte PV Aanhouding", color: "#FFE6A2", comboId: 'B'},
            {id: "34", label: "art. 56 Sv", color: "#88271F"},
            {id: "35", label: "art. 9 lid 2 Opw", color: "#88271F"},
            {id: "36", label: "art 52, lid 2 WWM", color: "#88271F"},
            {id: "37", label: "Verdachte - PV verhoor", color: "#FFE6A2", comboId: 'B'},
            {id: "38", label: "Munitie - PO bloedsporen", color: "#FFC67B", comboId: 'B'},
            {id: "39", label: "Munitie - PO kogelhuls plaats delict", color: "#FFC67B", comboId: 'B'},
            {id: "40", label: "Munitie - PO detailopname kogel", color: "#FFC67B", comboId: 'B'},
            {id: "41", label: "Munitie - PO - kogelhuls", color: "#FFC67B", comboId: 'B'},
            {id: "42", label: "Munitie - KVI hulzen", color: "#FFC67B", comboId: 'B'},
        ],
        edges: [
            {
                source: '0',
                target: '1',
            },
            {
                source: '0',
                target: '2',
            },
            {
                source: '1',
                target: '4',
            },
            {
                source: '0',
                target: '3',
            },
            {
                source: '3',
                target: '4',
            },
            {
                source: '2',
                target: '5',
            },
            {
                source: '1',
                target: '6',
            },
            {
                source: '1',
                target: '7',
            },
            {
                source: '3',
                target: '8',
            },
            {
                source: '3',
                target: '9',
            },
            {
                source: '5',
                target: '10',
            },
            {
                source: '5',
                target: '11',
            },
        ],
        combos: [
            {
                id: 'A',
                label: 'PV',
                style: {
                    fill: '#C4E3B2',
                    stroke: '#C4E3B2',
                },
            },
            {
                id: 'B',
                label: 'Munitie',
                style: {
                    stroke: '#99C0ED',
                    fill: '#99C0ED',
                },
            },
            {
                id: 'C',
                label: 'combo C',
                style: {
                    stroke: '#eee',
                    fill: '#eee',
                },
            },
        ],
    };

    data.nodes.forEach((node) => {
        switch (node.ComboId) {
            case 'A':
                node.style = {
                    fill: '#C4E3B2',
                    stroke: '#aaa',
                };
                break;
            case 'B':
                node.style = {
                    fill: '#99C0ED',
                    stroke: '#aaa',
                };
                break;
            case 'C':
                node.style = {
                    fill: '#eee',
                    stroke: '#aaa',
                };
                break;

        }
    });

    G6.registerNode('dom-node', {
        draw: (cfg, group) => {
            const stroke = cfg.style ? cfg.style.stroke || '#5B8FF9' : '#5B8FF9';
            const stickercolor = cfg.color;
            const shape = group.addShape('dom', {
                attrs: {
                    width: cfg.size[0],
                    height: cfg.size[1],
                    html: `
        <div id=${
                        cfg.id
                    } class='dom-node' style="background-color: #fff; border: 0px solid ${stroke}; border-radius: 5px; width: ${
                        cfg.size[0] - 5
                    }px; height: ${cfg.size[1] - 5}px; display: flex;">
          <div style="height: 100%; width: 33%; background-color: ${stickercolor}">
            <img alt="" style="line-height: 100%; margin-left: 7px;" src="sticker.svg" width="64" height="64" />
          </div>
          <span style="margin:auto; padding:auto; color: #5B8FF9">${cfg.label}</span>
        </div>
          `,
                },
                draggable: true,
            });
            return shape;
        },
    });

    let sortByCombo = false;
    const descriptionDiv = document.createElement('button');
    descriptionDiv.innerHTML = 'Enable sortByCombo';
    const container = document.getElementById('container');
    container.appendChild(descriptionDiv);

    descriptionDiv.addEventListener('click', (e) => {
        sortByCombo = !sortByCombo;
        descriptionDiv.innerHTML = sortByCombo ? 'Disable sortByCombo' : 'Enable sortByCombo';
        graph.updateLayout({
            sortByCombo,
        });
    });
    const width = container.scrollWidth;
    const height = (container.scrollHeight || 500) - 30;
    const graph = new G6.Graph({
        container: 'container',
        width,
        height: height - 50,
        fitView: true,
        fitViewPadding: 30,
        animate: true,
        renderer: 'svg',
        groupByTypes: true,
        modes: {
            default: [
                'drag-combo',
                'drag-node',
                'drag-canvas',
                'zoom-canvas',
                {
                    type: 'collapse-expand-combo',
                    relayout: false,
                },
            ],
        },
        layout: {
            type: 'dagre',
            sortByCombo: true,
            ranksep: 50,
            nodesep: 50,
        },
        defaultNode: {
            size: [200, 70],
            type: 'dom-node',
            //anchorPoints: [[0.5, 0], [0.5, 1]]
        },
        defaultEdge: {
            type: 'line',
        },
        defaultCombo: {
            type: 'rect',
            style: {
                fillOpacity: 0.1,
            },
        },
    });

    graph.on('wheelzoom', (e) => {
      e.stopPropagation();
      // className g6-component-tooltip by default
      const tooltips = Array.from(document.getElementsByClassName('g6-component-tooltip'));
      tooltips.forEach((tooltip) => {
        if (tooltip && tooltip.style) {
          tooltip.style.transform = `scale(${graph.getZoom()})`;
        }
      });
    });


    graph.data(data);
    graph.render();

    console.log('comboTrees', graph.get('comboTrees'))


    const bindClickListener = () => {
        const domNodes = document.getElementsByClassName('dom-node');
        for (let i = 0; i < domNodes.length; i++) {
            const dom = domNodes[i];
            // open the following lines pls!
            dom.addEventListener('click', (e) => {
               listener(dom);
            });
        }
    };

    bindClickListener();

    // after update the item, all the DOMs will be re-rendered
    // so the listeners should be rebinded to the new DOMs
    graph.on('afterupdateitem', (e) => {
        bindClickListener();
    });
    graph.on('afterrender', (e) => {
        bindClickListener();
    });
    // if it is TreeGraph and with default animate:true, you should bind the litsener after animation
    graph.on('afteranimate', (e) => {
       bindClickListener();
    });


    // Last part
    if (typeof window !== 'undefined')
        window.onresize = () => {
            if (!graph || graph.get('destroyed')) return;
            if (!container || !container.scrollWidth || !container.scrollHeight) return;
            graph.changeSize(container.scrollWidth, container.scrollHeight - 30);
        };






</script>
</body>
</html>
